---
title: 우리FISA 클라우드 서비스 개발 과정 - 파이널 프로젝트 4주차 회고
date: '2023-08-26'
tags: ['woori-fisa']
draft: false
---

## 드디어 화면 끝!

실제로 화면을 작업 한 시간은 9일정도 된 것 같다. 예상보다는 조금 늦어지긴 했지만
그래도 나름대로 만족스러운 결과물이 되었고 팀원들도 금방금방 내가 만든 컴포넌트들을
잘 사용해주어서 더 빨리 끝날 수 있었던 것 같다.

<div align="center">

![ezgif com-video-to-gif (1)](https://github.com/Jiyun-Parkk/jenkins-test/assets/72537762/6e16bf07-08e1-4889-ae6a-30f7a2a40011)

<figcaption>만족만족</figcaption>

</div>

반응형 부분은 몇몇 깨지는 곳이 있어서 추가 수정을 해야 하지만 이제는 진짜 개발에 집중해야 관리자까지 작업할 수 있기 때문에 이정도로만 일단 마무리하기로 했다.

관련 이슈만 대략 30개정도가 되었고, 구현된 페이지는 13페이지이다.

- [x] 로그인 페이지
- [x] 회원가입 페이지
- [x] 메인 페이지
- [x] 마이페이지
- [x] 상품등록 페이지
- [x] 상품 전체리스트 페이지
- [x] 상품 상세페이지
- [x] 상품 구매하기 페이지
- [x] 상품 구매 완료 페이지
- [x] 신고 접수 페이지
- [x] 반품 접수 페이지
- [x] 배송 등록 페이지
- [x] 프로필 수정 페이지

<div align="center">

![image](https://github.com/Jiyun-Parkk/jenkins-test/assets/72537762/7cf9ff08-fc80-4239-b35e-f3623c8cc847)

</div>

## same-site? 세션쿠키 에러 해결하기 - feat.다시 보고 싶지 않았던 403

내가 화면을 열심히 그리고 있을때 진영님께서 인증인가 부분의 API를 개발해주셨는데, 화면을 완료한 후에 해당 API 연결작업을 해보았다.

우리 프로젝트의 첫 API 연결이었는데, 결과는...실패였다.

몇시간을 해당 에러를 해결하기 위해 애썼는데, 결국 이유는 세션쿠키를 클라이언트와 서버가 주고 받을 때 추가로 필요한 설정들을 해주지 않아서 였다.

## 쿠키와 CSRF 문제

쿠키에 별도로 설정을 가하지 않는다면, 크롬을 제외한 브라우저들은 모든 HTTP 요청에 대해서 쿠키를 전송하게 된다. 그 요청에는 HTML 문서 요청, HTML 문서에 포함된 이미지 요청, XHR 혹은 Form을 이용한 HTTP 요청등 모든 요청이 포함된다.

CSRF(Cross Site Request Forgery)는 이 문제를 노린 공격인데 아래와 같은 방식을 가지고 있다.

- 공격대상 사이트는 쿠키로 사용자 인증을 수행함.
- 피해자는 공격 대상 사이트에 이미 로그인 되어있어서 브라우저에 쿠키가 있는 상태.
- 공격자는 피해자에게 그럴듯한 사이트 링크를 전송하고 누르게 함. (공격대상 사이트와 다른 도메인)
- 링크를 누르면 HTML 문서가 열리는데, 이 문서는 공격 대상 사이트에 HTTP 요청을 보냄.
- 이 요청에는 쿠키가 포함(서드 파티 쿠키)되어 있으므로 공격자가 유도한 동작을 실행할 수 있음.

이러한 문제를 해결하기 위한 것이 바로 samesite 이다. SameSite 쿠키는 앞서 언급한 서드 파티 쿠키의 보안적 문제를 해결하기 위해 만들어진 기술이다. 크로스 사이트(Cross-site)로 전송하는 요청의 경우 쿠키의 전송에 제한을 두도록 한다.

결론적으로 sameSite 쿠키는 서로 다른 리소스 간의 쿠키 전송을 막는다는 것이다.

그럼 이 부분이 왜 우리 프로젝트에서 문제가 되었을까?

그건 바로 우리 프로젝트에서 백엔드 서버의 리소스와 프론트 프로젝트의 리소스가 다른데다가, 브라우저의 기본 정책이 변경되었기 때문이다.

## 크롬 브라우저의 바뀐 정책

크롬은 SameSite를 가장 적극적으로 적용하고 있는 브라우저이다. 원래 SameSite를 명시하지 않은 쿠키는 SameSite가 None으로 동작했지만, 2020년 2월 4일 크롬 80 버전이 배포되면서 SameSite의 기본값이 Lax로 변경되었고, 서드 파티 쿠키는 전송할 수 없게 된 것이다.

이 sameSite를 `none`으로 설정하면 서트 파티의 쿠키를 전송할 수 있게 된다.

그런데 위에서 언급했듯, sameSite `none` 설정은 csrf 공격의 위험을 가지고 있다. 따라서 크롬에서는 추가적으로 규칙을 하나 더 가고 있는데 `secure` 속성을 가지고 있어야 한다는 것이다. `secure` 속성을 가지고 있어야 한다는 것은 `https`를 적용해서 암호화된 요청을 보낼 수 있도록 해야 한다는 것이다.

<div align="center">

![image](https://github.com/Jiyun-Parkk/jenkins-test/assets/72537762/31387975-d301-4ba7-8a75-a09f5234de4e)

</div>

## sameSite, secure 설정 그리고 Https 적용

위의 에러를 해결하기 위해서 먼저 백엔드 서버 쪽에서 `sameSite=none` 설정을 해주고 아래의 순서로 백엔드와 프론트의 https 적용 작업을 해주었다.

- 가비아에서 백엔드와 프론트 도메인 주소 구입
- AWS Certificate에서 ssl 인증서 발급
- Route53에 도메인 등록
- 해당 도메인에 ssl 인증서 적용
- 백엔드, 프론트 EC2 인스턴스의 로드밸런서를 생성하여 https로 포워딩 될 수 있도록 설정

결과적으로는 세션 쿠키에 대해서 더 공부하고 알아갈 수 있는 시간이 되었고, ssl 인증서를 발급받아 https를 적용시키는 경험도 해볼 수 있어서 의미있는 시간이 되었다.

이번 기회로 네트워크에 대해서 더 공부해야한다는 것을 한번 더 깨닫게 된 것 같다.

#우리FIS아카데미 #우리에프아이에스 #우리FIS Future 핀테크랩 #우리FISA #클라우드서비스개발 #K-Digital Traning #기술세미나
